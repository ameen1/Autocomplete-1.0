/* ========================================================================
 * Autocomplete by solaiman kmail (psokmail@gmail.com) 
 * http://psokmail.com
 * https://github.com/skmail/autocomplete
 * ======================================================================== */
(function(e){e.fn.autocomplete=function(t){var t=e.extend(true,{},{url:null,ajaxRequestMethod:"get",dataSource:null,startOnChar:3,containerMainSelectorClass:"autocomplete-results",containerElementName:"ul",itemElementName:"li",containerSelectorClass:null,itemSelectorClass:null,selectedClass:null,renderResultItem:e.fn.autocomplete.renderResultItem,onMouseSelect:e.fn.autocomplete.onMouseSelect,onEnter:e.fn.autocomplete.onEnter,showMoreButton:false,showMoreButtonLabel:"Show More Results",showMoreButtonUrl:"#{{keyword}}"},t);return this.each(function(){t.inputBox=e(this);t.inputBox.keydown(function(n){var r=n.keyCode?n.keyCode:n.which;if(r==13){resultsContainer=e(this).next("."+t.containerMainSelectorClass);if(e(resultsContainer).size()>0){selectedObject=e(resultsContainer).find(" > .selected")}if(selectedObject.length==0){selectedObject=null}t.onEnter(selectedObject,t,n)}});t.inputBox.keyup(function(n){var r=n.keyCode?n.keyCode:n.which;var i=e(this).next("."+t.containerMainSelectorClass);if(r==40||r==38){if(r==40){e.fn.autocomplete.show(t)}if(e(i).size()>0){if(e(i).find(" > "+t.itemElementName+".selected").size()>0){currentSelectedItem=e(i).find(" > "+t.itemElementName+".selected");e.fn.autocomplete.removeSelected(e(i).find(" > "+t.itemElementName+".selected"),t);if(r==40){if(t.showMoreButton==true&&currentSelectedItem.next().hasClass("show-more-button")){currentSelectedItem=e(i).find(" > "+t.itemElementName).first();e.fn.autocomplete.addSelected(currentSelectedItem,t)}else{e.fn.autocomplete.addSelected(currentSelectedItem.next(),t)}}else if(r==38){if(currentSelectedItem.is(":first-child")){if(t.showMoreButton==true&&e(i).find(" > "+t.itemElementName).last().hasClass("show-more-button")){currentSelectedItem=e(i).find(" > "+t.itemElementName).eq(-2)}else{currentSelectedItem=e(i).find(" > "+t.itemElementName).last()}e.fn.autocomplete.addSelected(currentSelectedItem,t)}else{e.fn.autocomplete.addSelected(currentSelectedItem.prev(),t)}}}else{currentSelectedItem=e(i).find(" > "+t.itemElementName).first();e.fn.autocomplete.addSelected(currentSelectedItem,t)}}}if(e(this).val()==e(this).data("current-val")){return}else{e(this).data("current-val",e(this).val())}e.fn.autocomplete.removeResults(t);if(e(this).val().length<t.startOnChar){return}if(t.url==null){return}t.keyword=e(this).val();e.fn.autocomplete.sendRequest(t)});e("html").on("mouseenter","."+t.containerMainSelectorClass+" > "+t.itemElementName,function(){if(!e(this).hasClass("show-more-button")){e.fn.autocomplete.addSelected(e(this),t)}}).on("mouseleave","."+t.containerMainSelectorClass+" > "+t.itemElementName,function(){e.fn.autocomplete.removeSelected(e(this),t)});e("html").click(function(){e("."+t.containerMainSelectorClass).hide()});e("html").on("click","."+t.containerMainSelectorClass,function(e){e.stopPropagation()});e("html").on("click","."+t.containerMainSelectorClass+" > "+t.itemElementName,function(n){if(t.showMoreButton==false||t.showMoreButton==true&&!e(this).hasClass("show-more-button")){t.onMouseSelect(e(this),t,n);t.inputBox.trigger("keyup")}});t.inputBox.on("click",function(n){n.stopPropagation();e.fn.autocomplete.toggleResultsList(t)})})};e.fn.autocomplete.sendRequest=function(t){e.ajax({url:t.url,cache:true,data:{keyword:t.keyword},type:t.ajaxRequestMethod,dataType:"json",success:function(n){if(n.length!=0){e.fn.autocomplete.renderResults(n,t)}},error:function(e,t,n){}})};e.fn.autocomplete.renderResults=function(t,n){template=e("<"+n.containerElementName+' class="'+n.containerMainSelectorClass+'"></'+n.containerElementName+">").addClass(n.containerSelectorClass);e.each(t,function(t,r){_itemElement=e("<"+n.itemElementName+"></"+n.itemElementName+">");_itemElement.append(n.renderResultItem(r,_itemElement)).addClass(n.itemSelectorClass);template.append(_itemElement)});if(n.showMoreButton==true){showMoreButton=e("<"+n.itemElementName+"></"+n.itemElementName+">");showMoreButton.addClass("show-more-button");showMoreButtonUrl=n.showMoreButtonUrl.replace("{{keyword}}",n.keyword);showMoreButton.append('<a href="'+showMoreButtonUrl+'">'+n.showMoreButtonLabel+"</a>");template.append(showMoreButton)}template.insertAfter(n.inputBox)};e.fn.autocomplete.renderResultItem=function(e){return'<a href="">'+e+"</a>"};e.fn.autocomplete.removeResults=function(e){e.inputBox.next("."+e.containerMainSelectorClass).remove()};e.fn.autocomplete.onMouseSelect=function(t,n,r){n.inputBox.val(t.text());e.fn.autocomplete.hide(n)};e.fn.autocomplete.toggleResultsList=function(t){if(!t.inputBox.next("."+t.containerMainSelectorClass).is(":visible")){e.fn.autocomplete.show(t)}else{e.fn.autocomplete.hide(t)}};e.fn.autocomplete.onEnter=function(t,n,r){if(t!==null){n.inputBox.val(t.text())}e.fn.autocomplete.hide(n)};e.fn.autocomplete.hide=function(e){e.inputBox.next("."+e.containerMainSelectorClass).hide()};e.fn.autocomplete.show=function(e){e.inputBox.next("."+e.containerMainSelectorClass).show()};e.fn.autocomplete.addSelected=function(e,t){e.addClass("selected");e.addClass(t.selectedClass)};e.fn.autocomplete.removeSelected=function(e,t){e.removeClass("selected");e.removeClass(t.selectedClass)}})(jQuery)